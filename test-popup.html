<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Test Popup - LibMan</title>
    <style>
        :root {
            --brand: #2b7a78;
            --border: #e2e8f0;
            --text-medium: #64748b;
            --danger: #ef4444;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .card {
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .card-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: #f8fafc;
        }
        .card-body {
            padding: 24px;
        }
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            height: 120px;
        }
        option {
            padding: 4px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h3>Test Dropdown & Popup</h3>
            </div>
            <div class="card-body">
                <label style="display: block; font-size: 12px; font-weight: 500; color: var(--text-medium); margin-bottom: 4px;">
                    Chọn tài liệu để test popup
                </label>
                <select id="documentDropdown" onchange="selectDocumentFromDropdown(this)" size="5">
                    <option value="">-- Chọn tài liệu --</option>
                    <option value="TL001" data-name="Cấu trúc dữ liệu & Giải thuật" data-author="Nguyễn Văn A">
                        TL001 - Cấu trúc dữ liệu & Giải thuật (Nguyễn Văn A)
                    </option>
                    <option value="TL002" data-name="Lập trình Java" data-author="Trần Thị B">
                        TL002 - Lập trình Java (Trần Thị B)
                    </option>
                    <option value="TL003" data-name="Cơ sở dữ liệu" data-author="Lê Văn C">
                        TL003 - Cơ sở dữ liệu (Lê Văn C)
                    </option>
                </select>
            </div>
        </div>
    </div>

    <script>
        // Select document from dropdown and show popup
        function selectDocumentFromDropdown(selectElement) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            if (!selectedOption || !selectedOption.value) return;
            
            const documentId = selectedOption.value;
            const documentName = selectedOption.getAttribute('data-name');
            const documentAuthor = selectedOption.getAttribute('data-author') || '';
            
            // Show popup for quantity and price input
            showQuantityPricePopup(documentId, documentName, documentId, documentAuthor);
        }

        // Show popup for entering quantity and price
        function showQuantityPricePopup(docId, docName, docCode, docAuthor) {
            const popup = `
                <div id="quantityPriceModal" style="
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                    background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                    align-items: center; justify-content: center;">
                    <div style="
                        background: white; padding: 24px; border-radius: 8px; 
                        width: 90%; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                        <h3 style="margin: 0 0 16px 0; color: var(--brand);">Nhập thông tin tài liệu</h3>
                        
                        <div style="margin-bottom: 16px; padding: 12px; background: #f8fafc; border-radius: 6px;">
                            <p style="margin: 0; font-weight: 600;">${docName}</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: var(--text-medium);">
                                Mã: ${docCode} ${docAuthor ? '| Tác giả: ' + docAuthor : ''}
                            </p>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-size: 12px; font-weight: 500; color: var(--text-medium); margin-bottom: 4px;">
                                    Số lượng <span style="color: var(--danger);">*</span>
                                </label>
                                <input type="number" id="quantityInput" min="1" step="1" 
                                       placeholder="Nhập số lượng"
                                       style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 12px; font-weight: 500; color: var(--text-medium); margin-bottom: 4px;">
                                    Đơn giá (VNĐ) <span style="color: var(--danger);">*</span>
                                </label>
                                <input type="number" id="priceInput" min="0.01" step="0.01" 
                                       placeholder="Nhập đơn giá"
                                       style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;">
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" onclick="closeQuantityPriceModal()" 
                                    style="padding: 8px 16px; border: 1px solid var(--border); background: white; border-radius: 6px;">
                                Hủy
                            </button>
                            <button type="button" onclick="testSubmit()" 
                                    style="padding: 8px 16px; background: var(--brand); color: white; border: none; border-radius: 6px;">
                                Test Submit
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', popup);
            document.getElementById('quantityInput').focus();
        }

        // Close popup
        function closeQuantityPriceModal() {
            const modal = document.getElementById('quantityPriceModal');
            if (modal) {
                modal.remove();
            }
            // Reset dropdown selection
            document.getElementById('documentDropdown').selectedIndex = 0;
        }

        // Test submit function
        function testSubmit() {
            const quantity = parseInt(document.getElementById('quantityInput').value);
            const price = parseFloat(document.getElementById('priceInput').value);
            
            // Validation
            if (!quantity || quantity < 1 || !Number.isInteger(quantity)) {
                alert('Số lượng phải là số nguyên lớn hơn 0!');
                document.getElementById('quantityInput').focus();
                return;
            }
            
            if (!price || price <= 0) {
                alert('Đơn giá phải lớn hơn 0!');
                document.getElementById('priceInput').focus();
                return;
            }

            alert(`✅ Validation thành công!\nSố lượng: ${quantity}\nĐơn giá: ${price.toLocaleString()} đ`);
            closeQuantityPriceModal();
        }
    </script>
</body>
</html>